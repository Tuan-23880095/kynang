<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hoạt động nhóm: Dọn dẹp To-Do List</title>
    <!-- Tải Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Thêm font Inter */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Tạo kiểu cho phần tử khi đang được kéo */
        .dragging {
            opacity: 0.5;
            background: #fef9c3; /* yellow-100 */
            border: 2px dashed #fde047; /* yellow-400 */
        }
        .task-item {
            touch-action: none;
        }
    </style>
</head>
<body class="bg-gray-100 p-6 md:p-10">

    <div class="max-w-7xl mx-auto">
        <!-- Tiêu đề -->
        <header class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-blue-700 mb-2">Hoạt động nhóm: "Dọn dẹp To-Do List"</h1>
            <p class="mt-4 text-sm text-gray-500"><strong>Hướng dẫn:</strong> Kéo và thả các "nhiệm vụ" từ danh sách bên dưới vào 4 góc ma trận bên trên.</p>
        </header>

        <!-- Khu vực chính: Danh sách nhiệm vụ và Ma trận -->
        <main class="grid grid-cols-1 md:grid-cols-3 gap-8">

            <!-- Cột 1: Danh sách nhiệm vụ (order-2, md:order-1) -->
            <!-- Trên mobile, nó sẽ ở order 2 (bên dưới) -->
            <!-- Trên desktop, nó sẽ ở order 1 (bên trái) -->
            <aside class="md:col-span-1 order-2 md:order-1 bg-white p-4 md:p-6 rounded-lg shadow-lg">
                <h2 class="text-2xl font-bold mb-4 text-center text-gray-800">Danh sách nhiệm vụ</h2>
                <!-- 
                  Mobile: flex, flex-row, overflow-x-auto, space-x-3, min-h-[120px]
                  Desktop: md:flex-col, md:overflow-x-hidden, md:space-x-0, md:space-y-3, md:min-h-[300px]
                -->
                <div id="taskList" class="min-h-[120px] md:min-h-[300px] flex flex-row md:flex-col overflow-x-auto md:overflow-x-hidden md:overflow-y-auto space-x-3 md:space-x-0 md:space-y-3 p-2 md:p-0">
                    <!-- Các nhiệm vụ sẽ được thêm vào đây bằng JavaScript -->
                </div>
            </aside>

            <!-- Cột 2: Ma trận Eisenhower (order-1, md:order-2) -->
            <!-- Trên mobile, nó sẽ ở order 1 (bên trên) -->
            <!-- Trên desktop, nó sẽ ở order 2 (bên phải) -->
            <section class="md:col-span-2 order-1 md:order-2">
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
                    
                    <!-- Góc 1: Quan trọng & Khẩn cấp -->
                    <div id="q1" class="quadrant bg-red-100 border-2 border-red-300 rounded-lg p-5 min-h-[250px] md:min-h-[300px]" data-quadrant-name="q1">
                        <h3 class="text-lg md:text-xl font-bold text-red-700 text-center mb-4">
                            Góc 1: Làm ngay
                            <span class="block text-xs md:text-sm font-normal text-red-600">(Quan trọng & Khẩn cấp)</span>
                        </h3>
                        <div class="dropzone space-y-2 min-h-[150px] md:min-h-[200px]"></div>
                    </div>

                    <!-- Góc 2: Quan trọng & Không khẩn cấp -->
                    <div id="q2" class="quadrant bg-blue-100 border-2 border-blue-300 rounded-lg p-5 min-h-[250px] md:min-h-[300px]" data-quadrant-name="q2">
                        <h3 class="text-lg md:text-xl font-bold text-blue-700 text-center mb-4">
                            Góc 2: Lên lịch
                            <span class="block text-xs md:text-sm font-normal text-blue-600">(Quan trọng & Không khẩn cấp)</span>
                        </h3>
                        <div class="dropzone space-y-2 min-h-[150px] md:min-h-[200px]"></div>
                    </div>

                    <!-- Góc 3: Không quan trọng & Khẩn cấp -->
                    <div id="q3" class="quadrant bg-orange-100 border-2 border-orange-300 rounded-lg p-5 min-h-[250px] md:min-h-[300px]" data-quadrant-name="q3">
                        <h3 class="text-lg md:text-xl font-bold text-orange-700 text-center mb-4">
                            Góc 3: Ủy thác
                            <span class="block text-xs md:text-sm font-normal text-orange-600">(Không quan trọng & Khẩn cấp)</span>
                        </h3>
                        <div class="dropzone space-y-2 min-h-[150px] md:min-h-[200px]"></div>
                    </div>

                    <!-- Góc 4: Không quan trọng & Không khẩn cấp -->
                    <div id="q4" class="quadrant bg-gray-200 border-2 border-gray-400 rounded-lg p-5 min-h-[250px] md:min-h-[300px]" data-quadrant-name="q4">
                        <h3 class="text-lg md:text-xl font-bold text-gray-700 text-center mb-4">
                            Góc 4: Xóa bỏ
                            <span class="block text-xs md:text-sm font-normal text-gray-600">(Không quan trọng & Không khẩn cấp)</span>
                        </h3>
                        <div class="dropzone space-y-2 min-h-[150px] md:min-h-[200px]"></div>
                    </div>

                </div>
            </section>
        </main>

        <!-- ****** BẮT ĐẦU PHẦN MỚI ****** -->

        <!-- Phần Thảo luận & Lời khuyên -->
        <section class="mt-10 max-w-5xl mx-auto bg-white p-6 rounded-lg shadow-lg">
            <h2 class="text-2xl md:text-3xl font-bold text-center text-indigo-700 mb-6">Thảo luận & Lời khuyên</h2>
            
            <p class="text-center text-base md:text-lg text-gray-700 mb-6">
                Sau khi hoàn thành, hãy so sánh kết quả của nhóm bạn với các nhóm khác. Sẽ có những nhiệm vụ gây tranh rãi (ví dụ: "Đi xem phim với bạn mới", "Đi họp CLB").
            </p>
            <p class="text-center text-lg md:text-xl font-semibold text-red-600 bg-red-50 p-4 rounded-md mb-8">
                Đây là điểm mấu chốt: "Quan trọng" là thứ do BẠN định nghĩa, dựa trên mục tiêu dài hạn của bạn.
            </p>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Lời khuyên cho 4 góc -->
                <div class="bg-red-50 border border-red-200 p-4 rounded-lg">
                    <h4 class="font-bold text-base md:text-lg text-red-700">Góc 1: Làm ngay (Quan trọng, Khẩn cấp)</h4>
                    <p class="text-gray-600 mt-2 text-sm md:text-base">Đây là các "khủng hoảng". Bạn phải làm chúng ngay. Cố gắng giảm bớt các việc ở góc này bằng cách lập kế hoạch tốt hơn (chuyển chúng sang Góc 2 từ trước).</p>
                </div>
                
                <div class="bg-blue-50 border border-blue-200 p-4 rounded-lg">
                    <h4 class="font-bold text-base md:text-lg text-blue-700">Góc 2: Lên lịch (Quan trọng, Không khẩn cấp)</h4>
                    <p class="text-gray-600 mt-2 text-sm md:text-base">Đây là góc "thành công" của bạn: học tập, phát triển kỹ năng, xây dựng quan hệ, lập kế hoạch. Hãy dành nhiều thời gian nhất ở góc này.</p>
                </div>

                <div class="bg-orange-50 border border-orange-200 p-4 rounded-lg">
                    <h4 class="font-bold text-base md:text-lg text-orange-700">Góc 3: Ủy thác (Không quan trọng, Khẩn cấp)</h4>
                    <p class="text-gray-600 mt-2 text-sm md:text-base">Đây là những việc làm gián đoạn, thường là việc "xã giao" hoặc việc vặt. Nếu có thể, hãy ủy thác, tự động hóa, hoặc học cách nói "không" một cách lịch sự.</p>
                </div>

                <div class="bg-gray-100 border border-gray-300 p-4 rounded-lg">
                    <h4 class="font-bold text-base md:text-lg text-gray-700">Góc 4: Xóa bỏ (Không quan trọng, Không khẩn cấp)</h4>
                    <p class="text-gray-600 mt-2 text-sm md:text-base">Đây là những việc làm lãng phí thời gian, gây xao lãng. Hãy thẳng thắn loại bỏ chúng để tập trung vào những việc ở Góc 1 và 2.</p>
                </div>
            </div>
        </section>

        <!-- Phần Ma trận tham khảo -->
        <section id="referenceMatrixSection" class="mt-10 max-w-7xl mx-auto" style="display: none;">
            <h2 class="text-2xl md:text-3xl font-bold text-center text-indigo-700 mb-2">Gợi ý Ma trận tham khảo</h2>
            <p class="text-center text-gray-600 mb-6">Đây là một cách sắp xếp để sinh viên tham khảo. Kết quả của bạn có thể khác biệt tùy theo mục tiêu cá nhân!</p>
            
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
                
                <!-- Góc 1 tham khảo -->
                <div class="bg-red-100 border-2 border-red-300 rounded-lg p-5 min-h-[150px] md:min-h-[200px]">
                    <h3 class="text-lg md:text-xl font-bold text-red-700 text-center mb-4">Góc 1: Làm ngay</h3>
                    <div class="space-y-2">
                        <div class="task-item-static bg-yellow-200 p-3 rounded-lg shadow-sm border border-yellow-400 text-sm md:text-base">Ôn thi giữa kỳ môn Triết</div>
                        <div class="task-item-static bg-yellow-200 p-3 rounded-lg shadow-sm border border-yellow-400 text-sm md:text-base">Làm bài tập AV (nếu sắp đến hạn)</div>
                    </div>
                </div>

                <!-- Góc 2 tham khảo -->
                <div class="bg-blue-100 border-2 border-blue-300 rounded-lg p-5 min-h-[150px] md:min-h-[200px]">
                    <h3 class="text-lg md:text-xl font-bold text-blue-700 text-center mb-4">Góc 2: Lên lịch</h3>
                    <div class="space-y-2">
                        <div class="task-item-static bg-yellow-200 p-3 rounded-lg shadow-sm border border-yellow-400 text-sm md:text-base">Tìm tài liệu làm tiểu luận</div>
                        <div class="task-item-static bg-yellow-200 p-3 rounded-lg shadow-sm border border-yellow-400 text-sm md:text-base">Đọc sách chuyên ngành</div>
                        <div class="task-item-static bg-yellow-200 p-3 rounded-lg shadow-sm border border-yellow-400 text-sm md:text-base">Lập kế hoạch tuần tới</div>
                        <div class="task-item-static bg-yellow-200 p-3 rounded-lg shadow-sm border border-yellow-400 text-sm md:text-base">Đi tập thể dục</div>
                        <div class="task-item-static bg-yellow-200 p-3 rounded-lg shadow-sm border border-yellow-400 text-sm md:text-base">Gọi về cho gia đình</div>
                        <div class="task-item-static bg-yellow-200 p-3 rounded-lg shadow-sm border border-yellow-400 text-sm md:text-base">Dọn dẹp phòng trọ</div>
                    </div>
                </div>

                <!-- Góc 3 tham khảo -->
                <div class="bg-orange-100 border-2 border-orange-300 rounded-lg p-5 min-h-[150px] md:min-h-[200px]">
                    <h3 class="text-lg md:text-xl font-bold text-orange-700 text-center mb-4">Góc 3: Ủy thác</h3>
                    <div class="space-y-2">
                        <div class="task-item-static bg-yellow-200 p-3 rounded-lg shadow-sm border border-yellow-400 text-sm md:text-base">Đi họp CLB (trừ khi bạn là chủ chốt)</div>
                        <div class="task-item-static bg-yellow-200 p-3 rounded-lg shadow-sm border border-yellow-400 text-sm md:text-base">Kiểm tra email công việc/học tập</div>
                        <div class="task-item-static bg-yellow-200 p-3 rounded-lg shadow-sm border border-yellow-400 text-sm md:text-base">Trả lời tin nhắn (không khẩn cấp)</div>
                        <div class="task-item-static bg-yellow-200 p-3 rounded-lg shadow-sm border border-yellow-400 text-sm md:text-base">Đi xem phim với bạn mới (việc xã giao)</div>
                    </div>
                </div>

                <!-- Góc 4 tham khảo -->
                <div class="bg-gray-200 border-2 border-gray-400 rounded-lg p-5 min-h-[150px] md:min-h-[200px]">
                    <h3 class="text-lg md:text-xl font-bold text-gray-700 text-center mb-4">Góc 4: Xóa bỏ</h3>
                    <div class="space-y-2">
                        <div class="task-item-static bg-yellow-200 p-3 rounded-lg shadow-sm border border-yellow-400 text-sm md:text-base">Lướt TikTok</div>
                        <div class="task-item-static bg-yellow-200 p-3 rounded-lg shadow-sm border border-yellow-400 text-sm md:text-base">Mua sắm quần áo online</div>
                        <div class="task-item-static bg-yellow-200 p-3 rounded-lg shadow-sm border border-yellow-400 text-sm md:text-base">Ngủ trưa 1 tiếng (trừ khi cần)</div>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- ****** KẾT THÚC PHẦN MỚI ****** -->

        <!-- Nút Reset & Chấm điểm -->
        <footer class="text-center mt-10 mb-8 space-x-4">
            <button id="scoreButton" class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-lg shadow-md transition duration-300" style="display: none;">
                Chấm điểm
            </button>
            <button id="resetButton" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-6 rounded-lg shadow-md transition duration-300">
                Làm mới lại
            </button>
        </footer>

        <!-- Hiển thị điểm số -->
        <div id="scoreDisplay" class="text-center text-2xl font-bold mt-6 mb-8"></div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const initialTasks = [
                "Làm bài tập AV",
                "Lướt TikTok",
                "Gọi về cho gia đình",
                "Đi họp CLB",
                "Ôn thi giữa kỳ môn Triết",
                "Tìm tài liệu làm tiểu luận",
                "Đi xem phim với bạn mới",
                "Dọn dẹp phòng trọ",
                "Mua sắm quần áo online",
                "Đọc sách chuyên ngành",
                "Kiểm tra email công việc/học tập",
                "Lập kế hoạch tuần tới",
                "Đi tập thể dục",
                "Trả lời tin nhắn (không khẩn cấp) của bạn bè",
                "Ngủ trưa 1 tiếng"
            ];

            const taskListContainer = document.getElementById('taskList');
            const quadrants = document.querySelectorAll('.quadrant');
            const dropzones = document.querySelectorAll('.dropzone');
            const resetButton = document.getElementById('resetButton');

            // ****** BẮT ĐẦU PHẦN MỚI ******
            const scoreButton = document.getElementById('scoreButton');
            const scoreDisplay = document.getElementById('scoreDisplay');
            const referenceMatrixSection = document.getElementById('referenceMatrixSection');

            // Đây là đáp án tham khảo
            // Ánh xạ ID của task (task-0, task-1, ...) với ID của góc (q1, q2, q3, q4)
            const taskReferenceMap = {
                'task-0': 'q1',  // Làm bài tập AV
                'task-1': 'q4',  // Lướt TikTok
                'task-2': 'q2',  // Gọi về cho gia đình
                'task-3': 'q3',  // Đi họp CLB
                'task-4': 'q1',  // Ôn thi giữa kỳ môn Triết
                'task-5': 'q2',  // Tìm tài liệu làm tiểu luận
                'task-6': 'q3',  // Đi xem phim với bạn mới
                'task-7': 'q2',  // Dọn dẹp phòng trọ
                'task-8': 'q4',  // Mua sắm quần áo online
                'task-9': 'q2',  // Đọc sách chuyên ngành
                'task-10': 'q3', // Kiểm tra email công việc/học tập
                'task-11': 'q2', // Lập kế hoạch tuần tới
                'task-12': 'q2', // Đi tập thể dục
                'task-13': 'q3', // Trả lời tin nhắn (không khẩn cấp)
                'task-14': 'q4'  // Ngủ trưa 1 tiếng
            };
            
            const totalTasks = initialTasks.length;
            
            let dropCount = 0; // Thêm biến đếm số lần thả
            // ****** KẾT THÚC PHẦN MỚI ******

            let draggedItem = null;

            // Hàm khởi tạo danh sách nhiệm vụ
            function initializeTasks() {
                taskListContainer.innerHTML = ''; // Xóa sạch
                initialTasks.forEach((taskText, index) => {
                    const taskElement = document.createElement('div');
                    // Thêm class cho mobile (w-40, h-24, text-sm) và reset trên desktop (md:w-full, md:h-auto, md:text-base)
                    taskElement.classList.add('task-item', 'bg-yellow-100', 'p-3', 'rounded-lg', 'shadow-sm', 'cursor-move', 'border', 'border-yellow-300', 'transition-all', 'flex-shrink-0', 'w-40', 'md:w-full', 'h-24', 'md:h-auto', 'text-sm', 'md:text-base', 'flex', 'items-center', 'justify-center', 'text-center');
                    taskElement.textContent = taskText;
                    taskElement.draggable = true;
                    taskElement.id = 'task-' + index;
                    taskListContainer.appendChild(taskElement);
                });
                addDragListeners();
            }

            // Hàm thêm sự kiện kéo thả cho các task
            function addDragListeners() {
                const tasks = document.querySelectorAll('.task-item');
                tasks.forEach(task => {
                    // Sự kiện trên máy tính
                    task.addEventListener('dragstart', handleDragStart);
                    task.addEventListener('dragend', handleDragEnd);

                    // Sự kiện cho màn hình cảm ứng
                    task.addEventListener('touchstart', handleTouchStart, { passive: false });
                    task.addEventListener('touchmove', handleTouchMove, { passive: false });
                    task.addEventListener('touchend', handleTouchEnd);
                });
            }

            // ---- Sự kiện cho Kéo/Thả (Mouse) ----
            
            function handleDragStart(e) {
                draggedItem = this;
                setTimeout(() => this.classList.add('dragging'), 0);
                e.dataTransfer.effectAllowed = 'move';
                e.dataTransfer.setData('text/plain', this.id);
            }

            function handleDragEnd() {
                if(draggedItem) {
                    draggedItem.classList.remove('dragging');
                    draggedItem = null;
                }
            }

            dropzones.forEach(zone => {
                zone.addEventListener('dragover', handleDragOver);
                zone.addEventListener('dragenter', handleDragEnter);
                zone.addEventListener('dragleave', handleDragLeave);
                zone.addEventListener('drop', handleDrop);
            });

            function handleDragOver(e) {
                e.preventDefault(); // Cần thiết để cho phép thả
                e.dataTransfer.dropEffect = 'move';
            }

            function handleDragEnter(e) {
                e.preventDefault();
                this.classList.add('bg-gray-200', 'rounded-lg');
            }

            function handleDragLeave(e) {
                this.classList.remove('bg-gray-200', 'rounded-lg');
            }

            function handleDrop(e) {
                e.preventDefault();
                this.classList.remove('bg-gray-200', 'rounded-lg');
                
                const id = e.dataTransfer.getData('text/plain');
                const draggableElement = document.getElementById(id);
                
                if (draggableElement) {
                    this.appendChild(draggableElement);
                    // Thay đổi style khi đã vào ma trận
                    draggableElement.classList.remove('bg-yellow-100', 'border-yellow-300');
                    draggableElement.classList.add('bg-yellow-200', 'border-yellow-400');

                    // ****** BẮT ĐẦU PHẦN MỚI ******
                    // Đếm và kiểm tra để hiện nút
                    dropCount++;
                    if (dropCount >= 4) {
                        scoreButton.style.display = 'inline-block';
                    }
                    // ****** KẾT THÚC PHẦN MỚI ******
                }
            }
            
            // ---- Sự kiện cho Chạm (Touch) ----
            // Biến này để lưu trữ phần tử đang được kéo bằng cảm ứng
            let touchDraggedItem = null;
            let touchStartX = 0;
            let touchStartY = 0;

            function handleTouchStart(e) {
                // Chỉ cho phép kéo bằng một ngón tay
                if (e.touches.length !== 1) return;
                
                touchDraggedItem = this;
                
                // Lưu vị trí bắt đầu chạm
                touchStartX = e.touches[0].clientX;
                touchStartY = e.touches[0].clientY;
                
                // Tạo một bản sao để di chuyển
                const clone = touchDraggedItem.cloneNode(true);
                clone.id = 'touch-clone';
                clone.style.position = 'absolute';
                clone.style.zIndex = '1000';
                clone.style.pointerEvents = 'none'; // Để các sự kiện 'touchmove' có thể phát hiện 'elementFromPoint'
                clone.style.width = `${touchDraggedItem.offsetWidth}px`; // Giữ nguyên chiều rộng
                clone.style.opacity = '0.8';
                document.body.appendChild(clone);
                
                // Ẩn phần tử gốc
                touchDraggedItem.classList.add('dragging');

                // Di chuyển bản sao đến vị trí ngón tay
                updateClonePosition(e.touches[0]);
            }
            
            function handleTouchMove(e) {
                if (!touchDraggedItem || e.touches.length !== 1) return;
                
                // Ngăn cuộn trang khi đang kéo
                e.preventDefault(); 
                
                updateClonePosition(e.touches[0]);
            }

            function updateClonePosition(touch) {
                const clone = document.getElementById('touch-clone');
                if (!clone) return;
                
                clone.style.left = `${touch.clientX - (clone.offsetWidth / 2)}px`;
                clone.style.top = `${touch.clientY - (clone.offsetHeight / 2)}px`;
            }

            function handleTouchEnd(e) {
                if (!touchDraggedItem) return;
                
                const clone = document.getElementById('touch-clone');
                
                // Tìm vùng thả bên dưới ngón tay
                let dropTarget = null;
                if (clone) {
                    // Tạm thời ẩn clone để xác định phần tử bên dưới
                    clone.style.display = 'none'; 
                    dropTarget = document.elementFromPoint(e.changedTouches[0].clientX, e.changedTouches[0].clientY);
                    clone.style.display = 'block'; // Hiển thị lại
                } else {
                    dropTarget = document.elementFromPoint(e.changedTouches[0].clientX, e.changedTouches[0].clientY);
                }

                // Tìm dropzone gần nhất
                const targetDropzone = dropTarget ? dropTarget.closest('.dropzone') : null;
                
                if (targetDropzone) {
                    targetDropzone.appendChild(touchDraggedItem);
                    // Thay đổi style khi đã vào ma trận
                    touchDraggedItem.classList.remove('bg-yellow-100', 'border-yellow-300');
                    touchDraggedItem.classList.add('bg-yellow-200', 'border-yellow-400');

                    // ****** BẮT ĐẦU PHẦN MỚI ******
                    // Đếm và kiểm tra để hiện nút
                    dropCount++;
                    if (dropCount >= 4) {
                        scoreButton.style.display = 'inline-block';
                    }
                    // ****** KẾT THÚC PHẦN MỚI ******
                }

                // Xóa bản sao và hiển thị lại phần tử gốc
                if (clone) {
                    clone.remove();
                }
                touchDraggedItem.classList.remove('dragging');
                touchDraggedItem = null;
            }

            // ---- Sự kiện Nút Reset ----
            resetButton.addEventListener('click', () => {
                // Xóa tất cả task trong các ô
                dropzones.forEach(zone => {
                    zone.innerHTML = '';
                });
                // Tạo lại danh sách task ban đầu
                initializeTasks();

                // ****** BẮT ĐẦU PHẦN MỚI ******
                // Ẩn điểm và ma trận tham khảo
                scoreDisplay.innerHTML = '';
                referenceMatrixSection.style.display = 'none';

                // ****** BẮT ĐẦU PHẦN MỚI ******
                // Reset bộ đếm và ẩn nút chấm điểm
                dropCount = 0;
                scoreButton.style.display = 'none';
                // ****** KẾT THÚC PHẦN MỚI ******
            });

            // ****** BẮT ĐẦU PHẦN MỚI ******
            // ---- Sự kiện Nút Chấm điểm ----
            scoreButton.addEventListener('click', () => {
                let correctCount = 0;
                let unplacedCount = 0;

                for (let i = 0; i < totalTasks; i++) {
                    const taskId = 'task-' + i;
                    const taskElement = document.getElementById(taskId);
                    
                    if (!taskElement) continue;

                    const parentQuadrant = taskElement.closest('.quadrant');
                    const taskList = taskElement.closest('#taskList');
                    const correctQuadrantId = taskReferenceMap[taskId];

                    if (parentQuadrant && parentQuadrant.id === correctQuadrantId) {
                        correctCount++;
                        // Thêm viền xanh cho đáp án đúng
                        taskElement.style.border = '3px solid #10b981'; // green-500
                    } else if (taskList) {
                        unplacedCount++;
                        // Thêm viền xám cho cái chưa xếp
                         taskElement.style.border = '3px solid #9ca3af'; // gray-400
                    } else if (parentQuadrant) {
                        // Xếp sai vị trí
                        taskElement.style.border = '3px solid #ef4444'; // red-500
                    }
                }

                const score = Math.round((correctCount / totalTasks) * 100);

                let scoreHTML = `Bạn đã xếp đúng ${correctCount} / ${totalTasks} nhiệm vụ. <br> Điểm của bạn: <span class="text-blue-600">${score} / 100</span>`;
                
                if (unplacedCount > 0) {
                     scoreHTML += `<br><span class="text-sm text-red-500">Bạn còn ${unplacedCount} nhiệm vụ chưa xếp. Hãy hoàn thành và chấm lại nhé!</span>`;
                } else {
                     scoreHTML += `<br><span class="text-sm text-green-600">Bạn đã hoàn thành! Hãy xem ma trận tham khảo bên dưới.</span>`;
                }

                scoreDisplay.innerHTML = scoreHTML;

                // Hiển thị ma trận tham khảo
                referenceMatrixSection.style.display = 'block';
            });
            // ****** KẾT THÚC PHẦN MỚI ******

            // Khởi chạy lần đầu
            initializeTasks();
        });
    </script>
</body>
</html>
